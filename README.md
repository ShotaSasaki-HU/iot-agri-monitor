# 衛星×地上センサのクロスチェックによる農地の遠隔監視システム
## 0. 評価基準
- 完成度（10点）：実システムが安定して動作し，エンドツーエンドの通信が確認できる．
- 技術的正確性（10点）：データ形式・通信・可視化が正確で，再現性のある動作となっている．
- 発想・工夫（10点）：最低限以上の工夫が見られ，簡単でも独自性のある仕組みを導入している．

### プロジェクト例
- LAN 内で通信パイプラインを維持するためのVPN（Virtual Private Network）の構築
- MQTT 通信用のPrivate Brokerの構築
- 他の通信・可視化・制御パイプラインの構築など

## 1. テーマの概要
### 前提
農業におけるIoTの一例として，地上の畑などに突き刺した土壌水分センサの値を遠隔でモニターするシステムがある．

### 課題背景
単一の地上センサを用いた農業IoTでは「センサの値がおかしい」とアラートが出た場合，それが「本当に農地が乾いている」のか「センサが故障している」なのか判断できない．そのため「センサが故障しているだけなのにIT担当ではなく，農業事業者が様子を見に行く」という無駄足が起きるケースが存在する．

### 解決策
本システムは，「衛星データ（マクロ）から推定した土壌水分量」と「地上センサ（ミクロ）で計測した土壌水分量」をエッジデバイス（ラズパイ）で比較する．2つのデータに矛盾がないかラズパイが判断し，信頼性の高い情報を農業事業者に提供する．

## 2. システム全体像
ほとんど5.2節と同じだがセキュリティが不十分なので，それを補強することが主な作業となる．
<img src="./docs/system_overview.svg" alt="system_overview.svg">

### データの流れ
1. Publisher: ラズパイが，インターネットから衛星データを取得し，土壌水分量を推定．
2. Publisher: ラズパイが，仮想の土壌水分センサから値を取得．
3. Publisher: ラズパイが，2つのデータを比較判定（正常/異常/矛盾）し，デジタル署名を付与．
4. Publisher: MQTTSでBroker（Mosquitto）に送信．
5. Broker: Mosquittoが，データを受信．
6. Subscriber: Telegrafが，Mosquittoからデータを取得し，InfluxDBに渡す．
7. Subscriber: Grafanaが，InfluxDBから時系列データを取得して可視化．

### セキュリティ
|脅威の種類|脅威の説明|対策|
|:---|:---|:---|
|盗聴|農地の情報が漏洩|TLSによる通信経路の暗号化[^1]|
|Brokerのなりすまし|他人にデータを送ってしまう|TLSのサーバ証明書による認証[^2]|
|Publisherのなりすまし|異常なのに正常値を送りつける（逆も然り）|TLSのクライアント証明書による認証[^2]|
|Subscriberのなりすまし|a|^|
|改ざん||
|リプレイ攻撃||

[^1]: [MQTTで強化するセキュリティ対策を分かりやすく解説 | オージス総研](https://www.ogis-ri.co.jp/column/iot/column/c107973.html)
[^2]: [mTLS（相互TLS）とは？SSL/TLSとの違いから分かりやすく解説 | GMOグローバルサインカレッジ](https://college.globalsign.com/blog/pki_mtls_20251010/)
[^3]: [SSL/TLSによるMQTT通信のセキュリティ強化 | EMQ](https://www.emqx.com/ja/blog/fortifying-mqtt-communication-security-with-ssl-tls#mqtt-セキュリティに-tls-が不可欠なのはなぜですか)
