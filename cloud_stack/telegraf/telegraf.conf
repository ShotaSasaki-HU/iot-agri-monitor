# Telegraf agent configuration (runs inside Docker on the PC)
[agent]
  interval = "2s"            # Run every 2 seconds
  round_interval = true

# Output plugin: write data into InfluxDB
[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]   # InfluxDB container hostname
  database = "iot_data"             # Create this DB manually once

# ==========================================
# MQTT over TLS (test.mosquitto.org)
# ==========================================
[[inputs.mqtt_consumer]]
  # Secure MQTT endpoint at test.mosquitto.org:8883
  servers = ["ssl://test.mosquitto.org:8883"]

  # Subscribe to the topic used by the Pi publisher
  topics = ["iot_course/group00/tls_demo"]

  # QoS: retries until broker ACKs
  qos = 1

  # Decode incoming messages as JSON
  data_format = "json"

  # Override measurement name in InfluxDB
  name_override = "mqtt_tls_demo"

  # TLS settings: use the CA certificate mounted into the container
  ssl_ca = "/etc/telegraf/mosquitto.org.crt"
  insecure_skip_verify = true
