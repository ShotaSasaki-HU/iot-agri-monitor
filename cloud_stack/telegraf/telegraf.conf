[agent]
  interval = "5s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  hostname = "telegraf"

# 出力先: InfluxDB
[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "iot_data"

# 入力元: MQTT (ここでクライアント証明書を使う！)
[[inputs.mqtt_consumer]]
  # Docker内のサービス名 "mosquitto" に接続
  servers = ["ssl://mosquitto:8883"]
  
  # 購読するトピック
  topics = ["iot/field/#"]
  data_format = "json"
  json_string_fields = ["data_status", "status"]
  
  # SSL/TLS設定
  tls_ca = "/etc/telegraf/certs/ca.crt"
  tls_cert = "/etc/telegraf/certs/telegraf.crt"
  tls_key = "/etc/telegraf/certs/telegraf.key"
  
  # オレオレ証明書なので検証を少し緩める(ホスト名チェック等をスキップ)
  insecure_skip_verify = true # falseにするとコンテナが起動しない？？
