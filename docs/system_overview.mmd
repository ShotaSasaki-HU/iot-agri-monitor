---
config:
  layout: dagre
---
flowchart LR
 subgraph WAN["â˜ï¸ Internet"]
        CDSE["ğŸ›°ï¸ Copernicus Data Space<br>(openEO API)"]
  end
 subgraph Edge["Publisher: ğŸ“ Raspberry Pi"]
        Logic{"âš¡ çªãåˆã‚ã›åˆ¤å®š"}
        Sensor("ğŸŒ± ä»®æƒ³ã®<br>åœŸå£Œæ°´åˆ†ã‚»ãƒ³ã‚µ")
        MQTT_Pub["ğŸ“¤ MQTT Publisher"]
  end
 subgraph Server["Broker, Subscriber:<br>ğŸ³ğŸ’» Docker PC"]
        subgraph Broker["Broker"]
            Mosquitto("ğŸ“¡ Mosquitto")
        end
        subgraph Subscriber["Subscriber"]
            Telegraf("ğŸ“¥ Telegraf")
            DB[("ğŸ›¢ï¸ InfluxDB")]
            Dash("ğŸ“Š Grafana")
        end
  end
 subgraph Evil["ğŸ’€ Attacker"]
        Script["æ”»æ’ƒã‚¹ã‚¯ãƒªãƒ—ãƒˆ"]
  end
 subgraph LAN["ğŸ  Local Area Network"]
        Edge
        Server
        Evil
  end
    Sensor --> Logic
    CDSE -- HTTPS --> Logic
    Logic -- æš—å·åŒ– --> MQTT_Pub
    MQTT_Pub == ğŸ”’ MQTTS (Port 8883)<br>[Client Cert Required] ==> Mosquitto
    Mosquitto --> Telegraf
    Telegraf --> DB
    DB --> Dash
    Script -. âŒ Blocked (No Cert) .-> Mosquitto

     CDSE:::internet
    classDef internet fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef edge fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef server fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef attack fill:#ffebee,stroke:#c62828,stroke-width:2px